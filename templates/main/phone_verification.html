{% load staticfiles %}
<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Верификация пользователя</title>
    <link rel="shortcut icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon" />
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon" />
    <link rel="stylesheet" href="{% static 'styles/bootstrap.min.css' %}" media="all" />
    <link rel="stylesheet" href="{% static 'styles/default.css' %}" />
    <link rel="stylesheet" href="{% static 'styles/load.css' %}" media="none" onload="if(media!='all')media='all'" />
    <link rel="stylesheet" href="{% static 'styles/player_skin/vkontakte.css' %}" media="none" onload="if(media!='all')media='all'" />
    <script>
    function on(elSelector,eventName,selector,fn) {var element = document.querySelector(elSelector);element.addEventListener(eventName, function(event) {var possibleTargets = element.querySelectorAll(selector);var target = event.target;for (var i = 0, l = possibleTargets.length; i < l; i++) {var el = target;var p = possibleTargets[i];while(el && el !== element) {if (el === p) {return fn.call(p, event);}el = el.parentNode;}}});};
    var ready = (callback) => {if (document.readyState != "loading") callback();else document.addEventListener("DOMContentLoaded", callback);}
    function elementInViewport(el){var bounds = el.getBoundingClientRect();return ((bounds.top + bounds.height > 0) && (window.innerHeight - bounds.top > 0));}
  </script>
</head>
  <body class="fixed-header sidebar-left-close">
    <div class="wrapper">

				<span class="col-xs-12 col-md-12 jambotron-fluid" style="display:flex !important;flex-wrap: wrap;padding-right:0px;padding-left:0px;">
          <div class="col-md-1"></div>
					<div class="col-md-2"></div>
          <div class="col-md-6" id="ajax" style="padding-right:0px;padding-left:0px;">
                <h1 class="font-weight-light mb-3 mt-4 content-color-secondary text-left">{{ request.user.get_full_name }}!</h1>
                <p>Для усиление информационной безопасности Вам нужно подтвердить с помощью телефона свою личность, и в будущем использовать номер телефона в качестве логина к профилю соцсети трезвый.рус</p>
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-4 col-offset-1" style="display: inline-flex;margin-top: 12px;margin-bottom: 12px;">
                      <div class="input-group-prepend">
                        <span class="input-group-text">{{ request.user.get_last_location.phone }}</span>
                      </div>
                      <input type="number" id="phone" class="form-control border-0" placeholder="Телефон">
                      <hr class="my-0">
                    </div>
                    <div class="col-md-4" style="margin-top: 12px;">
                      <button type="button" id="phone_send" class="btn btn-primary pink-gradient">Получить код</button>
                    </div>
                    <div class="col-md-2"></div>
                </div>
                <div id='jsondata'></div>
                <div class="row block_verify" style="display:none">
                  <div class="col-md-2"></div>
                    <div class="col-md-4">
                        <input type="number" id="code" class="form-control border-0" placeholder="Последние 4 цифры">
                        <hr class="my-0">
                    </div>
                    <div class="mb-4 col-md-4">
                      <button type="button" id="code_send" class="btn btn-primary pink-gradient">Подтвердить</button>
                    </div>
                    <div class="col-md-2"></div>
                </div>
          </div>
           <div class="col-md-3"></div>
         </span>
     </div>

     <script type="text/javascript">

       document.getElementById("phone_send").addEventListener("click", (e) => {
       var phone = document.getElementById('phone').value;
       var request = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject( 'Microsoft.XMLHTTP' );
       request.open( 'GET', "/users/progs/phone_send/" + phone + "/", true );
       request.onreadystatechange = function () {
         if ( request.readyState == 4 && request.status == 200 && phone.length > 8) {
           document.querySelector(".block_verify").style.display = "block";
           var div = document.getElementById('jsondata');
           div.innerHTML = data.text;
         }
       };
       request.send( null );
     });

     document.getElementById("code_send").addEventListener("click", (e) => {
     var phone = document.getElementById('phone').value;
     var code = document.getElementById('code').value;
     var request = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject( 'Microsoft.XMLHTTP' );
     request.open( 'GET', "/users/progs/phone_verify/" + phone + "/" + code + "/", true );
     request.onreadystatechange = function () {
       if ( request.readyState == 4 && request.status == 200 ) {
         window.location = "{% url 'user' pk=request.user.pk %}";
       }
     };
     request.send( null );
   });
     </script>
   </body>
  </html>
