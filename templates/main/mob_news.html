{% extends "base_mobile.html" %}
{% load staticfiles humanize %}
{% block title %}Новости{% endblock %}
{% block meta %}
<meta property="og:url" content="" />
<link rel="stylesheet" href="{% static 'styles/swiper.min.css' %}" />
<meta property="og:type" content="website" />
<meta property="og:title" content="" />
<meta property="og:image" content="http://xn--b1afgj5al1e.xn--p1acf/{% static 'images/I.jpg' %}" />
{% endblock %}
{% block content %}

<div class="container mt-3">
    <div class="stream-update">
      <a href=""><span class="new-posts"></span> Загрузить новые записи</a>
    </div>
    <div class="dropdown">
      <button type="button" class="btn btn-secondary dropdown-toggle" style="width:100%;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Новости
      </button>
      <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 38px, 0px); top: 0px; width: 100%;">
          <a class="dropdown-item" href="#">Рекомендации</a>
          <a class="dropdown-item" href="#">Вы одобрили</a>
          <a class="dropdown-item" href="#">Вы не одобрили</a>
          <a class="dropdown-item" href="#">Ваши комментарии</a>
          <a class="dropdown-item" href="#">Фотографии</a>
      </div>
    </div>
    <span class="stream" id="stream">

      {% for object in object_list %}

        {% if object.community %}

          {% if object.article %}
            {% if object.is_repost %} Сообщество {{ object.community.name }} поделилось статьей {% endif %}
            {% if object.community in request.user.get_staffed_communities %}
              {% include 'item_community/moderator_article.html' with article=article %}
            {% else %}
              {% include 'item_community/article.html' with article=article %}
            {% endif %}
          {% endif %}
          {% if object.post %}
            {% if object.is_repost %} Сообщество {{ object.community.name }} поделилось записью {% endif %}
            {% if object.community in request.user.get_staffed_communities %}
              {% include 'item_community/moderator_post.html' with post=post %}
            {% else %}
              {% include 'item_community/post.html' with post=post %}
            {% endif %}
          {% endif %}

        {% else %}

          {% if object.article %}
            {% if object.is_repost %} {{ object.creator }} поделился статьей {% endif %}
            {% if object.creator == request.user %}
              {% include 'item_user/my_article.html' with article=article %}
            {% else %}
              {% include 'item_user/article.html' with article=article %}
            {% endif %}
          {% endif %}
          {% if object.post %}
            {% if object.is_repost %} {{ object.creator }} поделился записью {% endif %}
            {% if object.creator == request.user %}
              {% include 'item_user/my_post.html' with post=post %}
            {% else %}
              {% include 'item_user/post.html' with post=post %}
            {% endif %}
          {% endif %}

        {% endif %}

      {% endfor %}
    </span>
</div>

<script>

var page = 2;
var loaded = false;
onscroll = function(){
  try{
  if(news_load.querySelectorAll('.infinite-item').length === (page-1)*30){
  height = document.documentElement.clientHeight-1;
  if(window.scrollY+1 >= document.documentElement.scrollHeight-height){
    if (loaded){return};
    var link_3 = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject( 'Microsoft.XMLHTTP' );
    link_3.open( 'GET', '{% url "main" %}?page=' + page++, true );
    if(!loaded){link_3.send()};

    link_3.onreadystatechange = function () {
    if ( this.readyState == 4 && this.status == 200 ) {
      var elem = document.createElement('span');
      elem.innerHTML = link_3.responseText;
      if(elem.getElementsByClassName('infinite-item').length === 30){loaded = true;};
      var stream_load = document.getElementById("stream");
      stream_load.append(elem);
      }
    }
  }
}
}catch{return}
}
//updateSelected(icon_1);
</script>
{% endblock %}
