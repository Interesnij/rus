{% extends "base.html" %}
{% load staticfiles humanize %}
{% block title %}Новости{% endblock %}
{% block meta %}
<meta property="og:url" content="" />
<link rel="stylesheet" href="{% static 'styles/swiper.min.css' %}" />
<meta property="og:type" content="website" />
<meta property="og:title" content="" />
<meta property="og:image" content="http://xn--b1afgj5al1e.xn--p1acf/{% static 'images/I.jpg' %}" />
{% endblock %}
{% block content %}
<style>
  .toasts {
  width: 400px;
  position: fixed;
  top: 0;
  right: 40px;
}

.toast {
  width: 100%;
  margin-top: 50px;
  padding: 10px;
  position: relative;
  background-color: white;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
  color: #3d3d3d;
  cursor: pointer;
}
.toast span {
  display: inline-block;
  margin: 0 6px 0 3px;
}
.toast h3 {
  font-weight: 300;
  font-size: 1.1em;
}
.toast .exit {
  position: absolute;
  top: 7px;
  right: 7px;
  font-size: 1.1em;
}
.toast progress[value] {
  -webkit-appearance: none;
  appearance: none;
  position: absolute;
  width: 100%;
  left: 0;
  top: -2px;
  height: 5px;
}
.toast progress[value]::-webkit-progress-bar {
  background-color: white;
}

.success {
  background-color: #E8F5E9;
}
.success span {
  color: #4CAF50;
}
.success progress[value]::-webkit-progress-value {
  background-color: #4CAF50;
}
.success .fas {
  color: #4CAF50;
}

.error {
  background-color: #FFEBEE;
}
.error span {
  color: #EF5350;
}
.error progress[value]::-webkit-progress-value {
  background-color: #EF5350;
}
.error .icon {
  color: #EF5350;
}

.info {
  background-color: #E3F2FD;
}
.info span {
  color: #42A5F5;
}
.info progress[value]::-webkit-progress-value {
  background-color: #42A5F5;
}
.info .fas {
  color: #42A5F5;
}

.warning {
  background-color: #FFFDE7;
}
.warning span {
  color: #FFD600;
}
.warning progress[value]::-webkit-progress-value {
  background-color: #FFD600;
}
.warning .fas {
  color: #FFD600;
}
</style>
<div class="container mt-4 main-container">
    <div class="row">
        <div class="col-12 col-md-8 col-lg-8">
          <div class="stream-update">
            <a href=""><span class="new-posts"></span> Загрузить новые записи</a>
          </div>
          <div id="news_load" data-link="/main/news/"></div>
        </div>
        <div class="col-12 col-md-4 col-lg-4">
          <div class="card">
            <div class="card-body">
              <div class="nav flex-column nav-pills faqnav">
                <a class="ajax" href="/main/">Новости</a>
                <a class="ajax" href="/main/recomended/">Рекомендации</a>
                <a class="ajax" href="/main/like/">Вы одобрили</a>
                <a class="ajax" href="/main/dislike/">Вы не одобрили</a>
                <a class="ajax" href="/main/comments/">Ваши комментарии</a>
              </div>
            </div>
          </div>
        </div>
    </div>
</div>
<div class="button" id="success-btn">success</div>
<div class="button" id="error-btn">error</div>
<div class="button" id="info-btn">info</div>
<div class="button" id="warning-btn">warning</div>
<script>

var page = 2;
var loaded = false;
onscroll = function(){
  try{
  if(news_load.querySelectorAll('.infinite-item').length === (page-1)*30){
  height = document.documentElement.clientHeight-1;
  if(window.scrollY+1 >= document.documentElement.scrollHeight-height){
    if (loaded){return};
    var link_3 = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject( 'Microsoft.XMLHTTP' );
    link_3.open( 'GET', '{% url "news_list" %}?page=' + page++, true );
    link_3.onload = function(e) {if (this.status != 200) { console.log("ошибочка"); loaded = true; }};
    if(!loaded){link_3.send()};

    link_3.onreadystatechange = function () {
    if ( this.readyState == 4 && this.status == 200 ) {
      var elem = document.createElement('span');
      elem.innerHTML = link_3.responseText;
      if(elem.getElementsByClassName('infinite-item').length === 30){loaded = true;};
      var stream_load = document.getElementById("stream");

      stream_load.append(elem);
      }
    }
  }
}
}catch{return}
}

class ToastManager {
constructor(){
		this.id = 0;
		this.toasts = [];
		this.icons = {
			'ERROR': 'fa-exclamation-circle',
			'INFO': 'fa-info-circle',
			'WARNING': 'fa-exclamation-triangle',
		};

		var body = document.querySelector('body');
		this.toastsContainer = document.createElement('div');
		this.toastsContainer.classList.add('toasts');

		body.appendChild(this.toastsContainer);
	}

	showSuccess(message) {return this._showToast(message + "<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24'><path d='M0 0h24v24H0z' fill='none'><path d='M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z'></svg>");}
	showError(message) {return this._showToast(message, 'ERROR');}
	showInfo(message) {return this._showToast(message, 'INFO');}
	showWarning(message) {return this._showToast(message, 'WARNING');}

	_showToast(message, toastType) {
		var newId = this.id + 1;
		var newToast = document.createElement('div');
		newToast.style.display = 'inline-block';
		newToast.classList.add('toast');
		newToast.innerHTML = `
			<progress max="100" value="0"></progress>
			<h3><span></span> ${message} </h3>`;

		var newToastObject = {
			id: newId,
			message,
			type: toastType,
			timeout: 4000,
			progressElement: newToast.querySelector('progress'),
			counter: 0,
			timer: setInterval(() => {
				newToastObject.counter += 1000 / newToastObject.timeout;
				newToastObject.progressElement.value = newToastObject.counter.toString();
				if(newToastObject.counter >= 100) {
					newToast.style.display = 'none';
					clearInterval(newToastObject.timer);
					this.toasts = this.toasts.filter((toast) => {
						return toast.id === newToastObject.id;
					});
				}
			}, 10)
		}

		newToast.addEventListener('click', () => {
			newToast.style.display = 'none';
			clearInterval(newToastObject.timer);
			this.toasts = this.toasts.filter((toast) => {
				return toast.id === newToastObject.id;
			});
		});

		this.toasts.push(newToastObject);
		this.toastsContainer.appendChild(newToast);
		return this.id++;
	}
}

var toasts = new ToastManager();
var successBtn = document.querySelector('#success-btn');
var errorBtn = document.querySelector('#error-btn');
var infoBtn = document.querySelector('#info-btn');
var warningBtn = document.querySelector('#warning-btn');

successBtn.addEventListener('click', () => {toasts.showSuccess('Успех!');});
errorBtn.addEventListener('click', () => {toasts.showError('Ошибка!');});
infoBtn.addEventListener('click', () => {toasts.showInfo('Информационное сообщение!');});
warningBtn.addEventListener('click', () => {toasts.showWarning('Предупреждение!');});

</script>


{% endblock %}
