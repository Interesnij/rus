{% extends "base_mobile.html" %}
{% load staticfiles humanize %}
{% block title %}Подтверждение профиля{% endblock %}
{% block meta %}
<meta property="og:url" content="" />
<meta property="og:type" content="website" />
<meta property="og:title" content="" />
<meta property="og:image" content="http://xn--b1afgj5al1e.xn--p1acf/{% static 'images/I.jpg' %}" />
{% endblock %}
{% block content %}
    <h1 class="font-weight-light mb-3 mt-4 content-color-secondary text-left">{{ request.user.get_full_name }}!</h1>
    <p>Для усиление информационной безопасности Вам нужно подтвердить с помощью телефона свою личность, и в будущем использовать номер телефона в качестве логина к профилю соцсети трезвый.рус</p>
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-4 col-offset-1" style="display: inline-flex;margin-top: 12px;margin-bottom: 12px;">
          <div class="input-group-prepend">
            <span class="input-group-text">{{ request.user.get_last_location.phone }}</span>
          </div>
          <input type="number" id="phone" onkeyup="phone_check();" class="form-control border-0" placeholder="Телефон">
          <hr class="my-0">
        </div>
        <div class="col-md-4" style="margin-top: 12px;">
          <button type="button" disabled="disabled" id="phone_send" class="btn btn-primary pink-gradient">Получить код</button>
        </div>
        <div class="col-md-2"></div>
    </div>
    <div id='jsondata' style="margin-top:50px"></div>

    <div id='jsondata2' style="margin-top:50px"></div>



     <script type="text/javascript">
     function phone_check() {
      if (document.getElementById('phone').value.length > 9)
        document.getElementById("phone_send").removeAttribute('disabled');
      else
        document.getElementById("phone_send").setAttribute("disabled", "true");
      }
      function code_check() {
       if (document.getElementById('code').value.length === 4)
         document.getElementById("code_send").removeAttribute('disabled');
       else
         document.getElementById("code_send").setAttribute("disabled", "true");
       }

       document.getElementById("phone_send").addEventListener("click", (e) => {
        var phone = document.getElementById('phone').value;
       var request = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject( 'Microsoft.XMLHTTP' );
       request.open( 'GET', "/users/progs/phone_send/" + phone + "/", true );
       request.onreadystatechange = function () {
         if ( request.readyState == 4 && request.status == 200) {
           var div = document.getElementById('jsondata');
           div.innerHTML = request.responseText;
           document.getElementById("phone").setAttribute("disabled", "true");
           document.getElementById("phone_send").setAttribute("disabled", "true");
         }
       };
       request.send( null );
     });

     on('#ajax', 'click', '#code_send', function(e) {
     var phone = document.getElementById('phone').value;
     var code = document.getElementById('code').value;
     var request = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject( 'Microsoft.XMLHTTP' );
     request.open( 'GET', "/users/progs/phone_verify/" + phone + "/" + code + "/", true );
     request.onreadystatechange = function () {
       if ( request.readyState == 4 && request.status == 200 ) {
         var div = document.getElementById('jsondata2');
         div.innerHTML = request.responseText;
       }
     };
     request.send( null );
     });
     </script>

{% endblock %}
