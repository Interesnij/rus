{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Управление сообществом - смена аватара{% endblock %}
{% block content %}

<style>
.id_image input{
  display: none;
}
#image-holder{
    border: 2px dashed #FF0000;
    color: rgba(0, 0, 0, 0.8);
    padding: 10px;
    text-align: center;
    margin: 20px;
    cursor:pointer;
    width: 85%;
    min-width: 85%;
  }
  #image-holder img{
    width: 85%;
    height: auto;
  }
</style>
<div class="container mt-4 main-container">
    <div class="row">
        <div class="col-lg-7 col-md-8 col-sm-12 order-1">
            <form action="" id="AVATAR-FORM" method="post" enctype="multipart/form-data" class="contact-form">
                {% csrf_token %}
                <div class="form-group row">
                  <div class="id_image">{{ form.avatar }}</div>
                  <div id="image-holder">
                      <h4 style="font-weight:bold;font-size:65px;color:#CECECE">Баннер</h4>
                      <p>Нажмите, чтобы добавить</p>
                      <i style="">(не обязательно)</i>
                  </div>
                </div>
                <div class="card-footer">
                    <button type="submit" class="mb-2 btn btn-sm btn-success float-right">Сохранить</button>
                </div>
          </form>
      </div>
    </div>
  </div>

  <script type="text/javascript">
      var frm = $('#AVATAR-FORM');
      frm.submit(function() {
          $.ajax({
              type: frm.attr('method'),
              url: "{% url 'community_avatar' pk=commnity.pk %}",
              data: new FormData($(frm)[0]),
              contentType: false,
              cache: false,
              processData: false,
              success: function(data) {
                  $('#ajax').html('').load("/communities/reload/" + {{ commnity.pk }} + "/");
                  $('title').text('{{ community.name }}');
              },
              error: function(data) {
                  console.log("Все не ОК")
              }
          });
          return false;
      });
  </script>
  <script>
      var imageLoader = document.getElementById("id_avatar");
      var entrou = false;
      $("#image-holder").on("click", function() {
          $("#id_avatar").click();
      });

      $("#id_avatar").on("change", function() {
          if (!entrou) {
              var imgPath = $(this)[0].value;
              var extn = imgPath.substring(imgPath.lastIndexOf(".") + 1).toLowerCase();

              if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                  if (typeof FileReader != "undefined") {
                      var image_holder = $("#image-holder");
                      image_holder.empty();

                      var reader = new FileReader();
                      reader.onload = function(e) {
                          $img = $("<img />", {
                              id: "targetImageCrop",
                              src: e.target.result,
                              class: "thumb-image"
                          }).appendTo(image_holder);
                      };

                      image_holder.show();
                      reader.readAsDataURL($(this)[0].files[0]);
                  }
              } else {
                  this.value = null;
              }
          }
          entrou = true;
          setTimeout(function() {
              entrou = false;
          }, 1000);
      });
  </script>
{% endblock %}
