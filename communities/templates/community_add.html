{% load staticfiles %}

<div class="col-md-8 col-lg-6 col-xl-5 mx-auto">
    <form action="" id="FORM-COMMUNITY" method="post">
      {% csrf_token %}
        <div class="card mb-4">
            <div class="card-header border-bottom">
                <h5 class="content-color-primary mb-0">Создание сообщества</h5>
            </div>
            <div class="card-body">
                <br>
                <hr>
                <div class="row ">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group ">
                            <label>Название</label>
                            <input type="text" name="name" class="form-control" id="id_name">
                        </div>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group ">
                            <label>Категория</label>
                            <select class="form-control" id="sub_category" data-live-search="true" tabindex="-1" aria-hidden="true">
                                {% for object in categories %}
                                <option value="">Выберите категорию</option>
                                <option data-order="{{ object.order }}" value="{{ object.order }}">{{ object.name }}</option>
                                {% endfor %}
                            </select>
                            <div id="subcat"></div>
                        </div>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-lg-12 col-md-12">
                        <div class="form-group ">
                            <label>Тип открытости</label>
                            <select class="form-control" id="id_type" name="type" data-live-search="true" tabindex="-1" aria-hidden="true">
                                <option value="P">Публичный</option>
                                <option value="C">Закрытый</option>
                                <option value="T">Частный</option>
                            </select>
                        </div>
                    </div>
                </div>

            </div>
            <div class="card-footer">
                <button class="btn btn-secondary remove_form">Отмена</button>
                <button class="btn btn-success float-right add_com">Создать</button>
            </div>
        </div>
    </form>

</div>

<script>
  function loadCat() {
    var http = new XMLHttpRequest();
    http.open('GET', '{% url "community_ggg" %}', true);
    ajax = document.getElementById('ajax')
    ajax.innerHTML = http.responseText;
    http.send(null);
  };
  document.querySelector(".add_com").addEventListener("click", (e) => {
   var form10 = document.getElementById('FORM-COMMUNITY');
   var formEntries = new FormData(form10);
   var options = {
     method: 'POST',
     body: formEntries,
   };
   fetch('{% url "add_community" %}', options).then(data => {
     console.log("Все ОК")

   }).catch(error => {console.log("Все не ОК")});

});

    document.querySelector("#sub_category").addEventListener( 'change', function() {
        var val = this.value;
        if (val == '') {
          document.getElementById('subcat').innerHTML = "";
        } else {
          var link = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject( 'Microsoft.XMLHTTP' );
          link.open( 'GET', "/communities/progs/cat/" + val + "/", true );
          link.onreadystatechange = function () {
            if ( link.readyState == 4 ) {
                if ( link.status == 200 ) {
                    var sub = document.getElementById("subcat");
                    sub.innerHTML = link.responseText;
                }
            }
        };
        link.send( null );
        };
    });

  document.querySelector(".remove_form").addEventListener("click", () => {
    document.querySelector(".community_fullscreen").style.display = "none";
    document.getElementById('community_loader').innerHTML = "";
  });
</script>
