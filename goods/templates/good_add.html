{% load staticfiles %}
<link rel="stylesheet" href="{% static 'styles/dropzone.css' %}" />
<style>
  .id_image input{
    display: none;
  }
  .good_fullscreen_hide{
    cursor:pointer;
    float: right;
    margin-top: 12px;
  }
  #image-holder,
  #image-holder2,
  #image-holder3,
  #image-holder4,
  #image-holder5 {
      border: 2px dashed #FF0000;
      color: rgba(0, 0, 0, 0.8);
      padding: 10px;
      text-align: center;
      margin: 20px;
      cursor:pointer;
      width: 85%;
      min-width: 85%;
}
  #image-holder img,
  #image-holder2 img,
  #image-holder3 img,
  #image-holder4 img,
  #image-holder5 img {
    width: 85%;
    height: auto;
  }
</style>
<script src="{% static 'scripts/jquery.js' %}" type="text/javascript"></script>
<script defer src="{% static 'scripts/cockie.js' %}" type="text/javascript"></script>

<br>
<h5 class="m-0">Добавление товара</h5>
<br><br>

<form action="" id="FORM-GOOD" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group row">
      <div class="col-lg-6 col-md-6">
        <label>Название товара (обязательно)</label>
        <input type="text" required name="title" class="form-control" id="id_title">
      </div>
      <div class="col-lg-6 col-md-6">
        <label>Цена товара</label>
        <input type="number" required name="price" class="form-control" id="id_price">
      </div>
    </div>
    <div class="form-group row">
      <div class="col-lg-6 col-md-6">

        <label>Категория</label>
        <select class="form-control" id="category" data-live-search="true" tabindex="-1" aria-hidden="true">
          {% for object in categories %}
          <option value="">Выберите категорию</option>
          <option data-order="{{ object.order }}" value="{{ object.order }}">{{ object.name }}</option>
          {% endfor %}
        </select>
        <div id="subcat"></div>
        <label style="margin-top: 12px;">Описание товара</label>
        <textarea type="text" rows="4" name="description" class="form-control" id="id_description"></textarea>
      </div>

      <div class="col-lg-6 col-md-6">
        <br>
        <div class="id_image">{{ form.image }}</div>
        <div id="image-holder">
            <h4 style="font-weight:bold;font-size:65px;color:#CECECE">фото</h4>
            <p>Нажмите, чтобы добавить</p>

            <i style="">(обязательно)</i>

        </div>
      </div>
    </div>
    <div class="form-group row">
      <div class="col-lg-3 col-md-3">
        <div class="id_image">{{ form.image2 }}</div>
        <div id="image-holder2">
            <h4 style="font-weight:bold;font-size:30px;color:#CECECE">фото 2</h4>
            <p>Нажмите, чтобы добавить</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-3">
        <div class="id_image">{{ form.image3 }}</div>
        <div id="image-holder3">
            <h4 style="font-weight:bold;font-size:30px;color:#CECECE">фото 3</h4>
            <p>Нажмите, чтобы добавить</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-3">
        <div class="id_image">{{ form.image4 }}</div>
        <div id="image-holder4">
            <h4 style="font-weight:bold;font-size:30px;color:#CECECE">фото 4</h4>
            <p>Нажмите, чтобы добавить</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-3">
        <div class="id_image">{{ form.image5 }}</div>
        <div id="image-holder5">
            <h4 style="font-weight:bold;font-size:30px;color:#CECECE">фото 5</h4>
            <p>Нажмите, чтобы добавить</p>
        </div>
      </div>
    </div>
    <br>

    <div class="form-group ">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" checked class="custom-control-input" name="comments_enabled" id="id_comments_enabled">
            <label class="custom-control-label" for="id_comments_enabled">Разрешить комментарии</label>
        </div>
    </div>

    <div class="card-footer">
        <button class="btn btn-secondary remove_form">Отмена</button>
        <button type="submit" id="article_post" class="btn btn-success float-right">Опубликовать</button>
    </div>
</form>

<script>
  $('#category').change(function(){
    var val = $(this).val();
    if (val == ''){
      $('#subcat').empty();
    }else{
    $('#subcat').html('').load("/goods/cat/" + val + "/");
  };
  })
</script>
<script src="/static/scripts/jquery.toast.min.js" type="text/javascript"></script>
<script>
    var frm = $('#FORM-GOOD');
    $('#FORM-GOOD').submit(function(e) {
        e.preventDefault();
        $.ajax({
            type: frm.attr('method'),
            url: "{% url 'good_add_user' pk=user.pk %}",
            data: new FormData($(frm)[0]),
            contentType: false,
            cache: false,
            processData: false,

            success: function(data) {
                if (data.error) {
                    console.log(data);
                    console.log(data.content);
                    console.log(data.image);
                    $(".good_article").html(data.errors.descriptions);
                } else {
                    $(".goods_stream").prepend(data);
                    $('.good_add_fullscreen').hide();
                    $('#good_add_loader').empty();

                    $.toast({
                        heading: '{{ request.user.first_name }}',
                        text: 'Товар успешно создан!',
                        showHideTransition: 'fade',
                        icon: 'success',
                    })
                }
            },

            error: function(data) {
            }
        });
        return false;
    });
</script>
<script>
    var imageLoader = document.getElementById("id_image");
    var entrou = false;
    $("#image-holder").on("click", function() {
        $("#id_image").click();
    });

    $("#id_image").on("change", function() {
        if (!entrou) {
            var imgPath = $(this)[0].value;
            var extn = imgPath.substring(imgPath.lastIndexOf(".") + 1).toLowerCase();

            if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                if (typeof FileReader != "undefined") {
                    var image_holder = $("#image-holder");
                    image_holder.empty();

                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $img = $("<img />", {
                            id: "targetImageCrop",
                            src: e.target.result,
                            class: "thumb-image"
                        }).appendTo(image_holder);
                    };

                    image_holder.show();
                    reader.readAsDataURL($(this)[0].files[0]);
                }
            } else {
                this.value = null;
            }
        }
        entrou = true;
        setTimeout(function() {
            entrou = false;
        }, 1000);
    });
</script>
<script>
    var imageLoader = document.getElementById("id_image2");
    var entrou = false;
    $("#image-holder2").on("click", function() {
        $("#id_image2").click();
    });

    $("#id_image2").on("change", function() {
        if (!entrou) {
            var imgPath = $(this)[0].value;
            var extn = imgPath.substring(imgPath.lastIndexOf(".") + 1).toLowerCase();

            if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                if (typeof FileReader != "undefined") {
                    var image_holder = $("#image-holder2");
                    image_holder.empty();

                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $img = $("<img />", {
                            id: "targetImageCrop",
                            src: e.target.result,
                            class: "thumb-image"
                        }).appendTo(image_holder);
                    };

                    image_holder.show();
                    reader.readAsDataURL($(this)[0].files[0]);
                }
            } else {
                this.value = null;
            }
        }
        entrou = true;
        setTimeout(function() {
            entrou = false;
        }, 1000);
    });
</script>
<script>
    var imageLoader = document.getElementById("id_image3");
    var entrou = false;
    $("#image-holder3").on("click", function() {
        $("#id_image3").click();
    });

    $("#id_image3").on("change", function() {
        if (!entrou) {
            var imgPath = $(this)[0].value;
            var extn = imgPath.substring(imgPath.lastIndexOf(".") + 1).toLowerCase();

            if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                if (typeof FileReader != "undefined") {
                    var image_holder = $("#image-holder3");
                    image_holder.empty();

                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $img = $("<img />", {
                            id: "targetImageCrop",
                            src: e.target.result,
                            class: "thumb-image"
                        }).appendTo(image_holder);
                    };

                    image_holder.show();
                    reader.readAsDataURL($(this)[0].files[0]);
                }
            } else {
                this.value = null;
            }
        }
        entrou = true;
        setTimeout(function() {
            entrou = false;
        }, 1000);
    });
</script>
<script>
    var imageLoader = document.getElementById("id_image4");
    var entrou = false;
    $("#image-holder4").on("click", function() {
        $("#id_image4").click();
    });

    $("#id_image4").on("change", function() {
        if (!entrou) {
            var imgPath = $(this)[0].value;
            var extn = imgPath.substring(imgPath.lastIndexOf(".") + 1).toLowerCase();

            if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                if (typeof FileReader != "undefined") {
                    var image_holder = $("#image-holder4");
                    image_holder.empty();

                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $img = $("<img />", {
                            id: "targetImageCrop",
                            src: e.target.result,
                            class: "thumb-image"
                        }).appendTo(image_holder);
                    };

                    image_holder.show();
                    reader.readAsDataURL($(this)[0].files[0]);
                }
            } else {
                this.value = null;
            }
        }
        entrou = true;
        setTimeout(function() {
            entrou = false;
        }, 1000);
    });
</script>
<script>
    var imageLoader = document.getElementById("id_image5");
    var entrou = false;
    $("#image-holder5").on("click", function() {
        $("#id_image5").click();
    });

    $("#id_image5").on("change", function() {
        if (!entrou) {
            var imgPath = $(this)[0].value;
            var extn = imgPath.substring(imgPath.lastIndexOf(".") + 1).toLowerCase();

            if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                if (typeof FileReader != "undefined") {
                    var image_holder = $("#image-holder5");
                    image_holder.empty();

                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $img = $("<img />", {
                            id: "targetImageCrop",
                            src: e.target.result,
                            class: "thumb-image"
                        }).appendTo(image_holder);
                    };

                    image_holder.show();
                    reader.readAsDataURL($(this)[0].files[0]);
                }
            } else {
                this.value = null;
            }
        }
        entrou = true;
        setTimeout(function() {
            entrou = false;
        }, 1000);
    });
</script>
<script>
    $(".remove_form").click(function() {
        $('.good_add_fullscreen').hide();
        $('#good_add_loader').empty();
    });
</script>
