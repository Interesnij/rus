{% load staticfiles %}
<style>
  .id_image input {
          display: none;
      }
      .good_fullscreen_hide{
        cursor:pointer;
        float: right;
        margin-top: 12px;
      }
      #image-holder {
          border: 2px dashed #FF0000;
          color: rgba(0, 0, 0, 0.8);
          padding: 10px;
          text-align: center;
          margin: 20px;
          cursor:pointer;
      }

      #image-holder img {
          height: auto;
          width: 100%;
      }
</style>
<script src="{% static 'scripts/jquery.js' %}" type="text/javascript"></script>
<script defer src="{% static 'scripts/cockie.js' %}" type="text/javascript"></script>

<span class="good_fullscreen_hide">
  <img style="width:35px" src="{% static 'images/icons/close-24px.svg' %}" />
</span>

<br>
<h5 class="m-0">Добавление товара</h5>
<br><br>

<form action="" id="FORM-GOOD" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group row">
      <div class="col-lg-6 col-md-6">
        <label>Название товара (обязательно)</label>
        <input type="text" required name="title" class="form-control" id="id_title">
      </div>
      <div class="col-lg-6 col-md-6">
        <label>Цена товара</label>
        <input type="number" required name="price" class="form-control" id="id_price">
      </div>
    </div>
    <div class="form-group row">
      <div class="col-lg-6 col-md-6">

        <label>Категория</label>
        <select class="form-control" id="category" data-live-search="true" tabindex="-1" aria-hidden="true">
          {% for object in categories %}
          <option value="">Выберите категорию</option>
          <option data-order="{{ object.order }}" value="{{ object.order }}">{{ object.name }}</option>
          {% endfor %}
        </select>
        <div id="subcat"></div>
        <label style="margin-top: 12px;">Описание товара</label>
        <textarea type="text" rows="4" name="description" class="form-control" id="id_description"></textarea>
      </div>

      <div class="col-lg-6 col-md-6">
        <br>
        <div class="id_image">{{ form.image }}</div>
        <div id="image-holder">
            <h4 style="font-weight:bold;font-size:70px;color:#CECECE">фото</h4>
            <p>Нажмите, чтобы добавить</p>

            <i style="">(обязательно)</i>

        </div>
      </div>
    </div>
    <br>
    <div class="form-group ">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" checked class="custom-control-input" name="comments_enabled" id="id_comments_enabled">
            <label class="custom-control-label" for="id_comments_enabled">Разрешить комментарии</label>
        </div>
    </div>
    <form id="add-photos" method="post" action="{% url 'album' album.id %}" class="dropzone">
        {% csrf_token %}
    </form>
    <div class="card-footer">
        <button class="btn btn-secondary remove_form">Отмена</button>
        <button type="submit" id="article_post" class="btn btn-success float-right">Опубликовать</button>
    </div>
</form>


<script src="{% static 'scripts/dropzone.js' %}" type="text/javascript"></script>
<script>
  $('#category').change(function(){
    var val = $(this).val();
    if (val == ''){
      $('#subcat').empty();
    }else{
    $('#subcat').html('').load("/goods/cat/" + val + "/");
  };
  })
</script>
<script src="/static/scripts/jquery.toast.min.js" type="text/javascript"></script>
<script>
    var frm = $('#FORM-GOOD');
    $('#FORM-GOOD').submit(function(e) {
        e.preventDefault();
        $.ajax({
            type: frm.attr('method'),
            url: "{% url 'good_add_user' %}",
            data: new FormData($(frm)[0]),
            contentType: false,
            cache: false,
            processData: false,

            success: function(data) {
                if (data.error) {
                    console.log(data);
                    console.log(data.content);
                    console.log(data.image);
                    $(".good_article").html(data.errors.descriptions);
                } else {
                    $(".goods_stream").prepend(data);
                    $('.good_fullscreen').hide();
                    $('#good_loader').empty();

                    $.toast({
                        heading: '{{ request.user.first_name }}',
                        text: 'Товар успешно создан!',
                        showHideTransition: 'fade',
                        icon: 'success',
                    })
                }
            },

            error: function(data) {
            }
        });
        return false;
    });
</script>
<script>
    var imageLoader = document.getElementById("id_image");
    var entrou = false;
    $("#image-holder").on("click", function() {
        $("#id_image").click();
    });

    $("#id_image").on("change", function() {
        if (!entrou) {
            var imgPath = $(this)[0].value;
            var extn = imgPath.substring(imgPath.lastIndexOf(".") + 1).toLowerCase();

            if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                if (typeof FileReader != "undefined") {
                    var image_holder = $("#image-holder");
                    image_holder.empty();

                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $img = $("<img />", {
                            id: "targetImageCrop",
                            src: e.target.result,
                            class: "thumb-image"
                        }).appendTo(image_holder);
                    };

                    image_holder.show();
                    reader.readAsDataURL($(this)[0].files[0]);
                }
            } else {
                this.value = null;
            }
        }
        entrou = true;
        setTimeout(function() {
            entrou = false;
        }, 1000);
    });
</script>
<script>
    $(".remove_form").click(function() {
        $('.good_add_fullscreen').hide();
        $('#good_add_loader').empty();
    });
</script>
<script>
    $('.good_fullscreen_hide').on('click', function() {
        $('.good_add_fullscreen').hide();
        $('#good_add_loader').empty();
    });
</script>
