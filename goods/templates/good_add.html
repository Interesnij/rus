{% load staticfiles %}
<style>
    .id_image input {
        display: none;
    }

    #image-holder {
        border: 2px dashed #FF0000;
        color: rgba(0, 0, 0, 0.8);
        padding: 10px;
        text-align: center;
        margin: 10px;
    }

    #image-holder:hover {
        cursor: pointer;
        margin: 9px;
    }

    #image-holder img {
        height: auto;
        width: 100%;
    }
</style>
<script src="{% static 'scripts/jquery.js' %}" type="text/javascript"></script>
<script defer src="{% static 'scripts/cockie.js' %}" type="text/javascript"></script>

<span class="article_fullscreen_hide">
  <img style="width:35px" src="{% static 'images/icons/close-24px.svg' %}" />
</span>

<br>
<h5 class="m-0">Добавление статьи</h5>
<br><br>

<form action="" id="FORM-POST1" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group row">
      <div class="col-lg-6 col-md-6">
        <label>Название товара (обязательно)</label>
        <input type="text" required name="title" class="form-control" id="id_title">
      </div>
      <div class="col-lg-6 col-md-6">
        <label>Категория</label>
        <select class="form-control " data-live-search="true" tabindex="-1" aria-hidden="true">
            <option value="AF">Afghanistan</option>
            <option value="AX">Åland Islands</option>
            <option value="AL">Albania</option>
            <option value="DZ">Algeria</option>
            <option value="AS">American Samoa</option>
        </select>
      </div>
    </div>
    <br>
    <div class="form-group row">
      <div class="col-lg-6 col-md-6">
        <label>Цена товара</label>
        <input type="number" required name="price" class="form-control" id="id_price">
        <br>
        <label>Описание товара</label>
        <textarea type="text" rows="4" name="description" class="form-control" id="id_description"></textarea>
      </div>
      <div class="col-lg-6 col-md-6">
        <div class="id_image">{{ form.image }}</div>
        <div id="image-holder">
            <h4 style="font-weight:bold;font-size:70px;color:#CECECE">обложка</h4>
            <p>Нажмите, чтобы добавить</p>

            <i style="">(обязательно)</i>

        </div>
      </div>
    </div>
    <br>
    <div class="form-group">
        {{ form.content }}
    </div>
    <br>
    <div class="form-group ">
        <div class="custom-control custom-checkbox">
            <input type="checkbox" checked class="custom-control-input" name="comments_enabled" id="id_comments_enabled">
            <label class="custom-control-label" for="id_comments_enabled">Разрешить комментарии</label>
        </div>
    </div>
    <div class="respons_article"></div>
    <div class="card-footer">
        <button class="btn btn-secondary remove_form">Отмена</button>
        <button type="submit" id="article_post" class="btn btn-success float-right">Опубликовать</button>
    </div>
</form>


<script src="/static/scripts/jquery.toast.min.js" type="text/javascript"></script>
<script>
    var frm = $('#FORM-GOOD');
    $('#FORM-GOOD').submit(function(e) {
        e.preventDefault();
        CKEDITOR.instances.id_content.updateElement();
        $.ajax({
            type: frm.attr('method'),
            url: "{% url 'good_add_user' %}",
            data: new FormData($(frm)[0]),
            contentType: false,
            cache: false,
            processData: false,

            success: function(data) {
                if (data.error) {
                    console.log(data);
                    console.log(data.content);
                    console.log(data.image);
                    $(".good_article").html(data.errors.descriptions);
                } else {
                    $(".goods_stream").prepend(data);
                    $('.good_fullscreen').hide();
                    $('#good_loader').empty();

                    $.toast({
                        heading: '{{ request.user.first_name }}',
                        text: 'Товар успешно создан!',
                        showHideTransition: 'fade',
                        icon: 'success',
                    })
                }
            },

            error: function(data) {
                error_response(data);
            }
        });
        return false;
    });
</script>
<script>
    var imageLoader = document.getElementById("id_image");
    var entrou = false;
    $("#image-holder").on("click", function() {
        $("#id_image").click();
    });

    $("#id_image").on("change", function() {
        if (!entrou) {
            var imgPath = $(this)[0].value;
            var extn = imgPath.substring(imgPath.lastIndexOf(".") + 1).toLowerCase();

            if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                if (typeof FileReader != "undefined") {
                    var image_holder = $("#image-holder");
                    image_holder.empty();

                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $img = $("<img />", {
                            id: "targetImageCrop",
                            src: e.target.result,
                            class: "thumb-image"
                        }).appendTo(image_holder);
                    };

                    image_holder.show();
                    reader.readAsDataURL($(this)[0].files[0]);
                }
            } else {
                this.value = null;
            }
        }
        entrou = true;
        setTimeout(function() {
            entrou = false;
        }, 1000);
    });
</script>
<script>
    $(".remove_form").click(function() {
        $('.good_fullscreen').hide();
        $('#good_loader').empty();
    });
</script>
<script>
    $('.good_fullscreen_hide').on('click', function() {
        $('.good_fullscreen').hide();
        $('#good_loader').empty();
    });
</script>
