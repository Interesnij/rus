{% load staticfiles humanize %}

<div class="card mb-4 fullscreen infinite-item" post-id="{{ object.uuid_id }}" style="margin:10px">
    <div class="card-header border-bottom">
        <div class="media">
            <figure>
              {% if object.creator.profile.avatar %}
                <img src="{{ object.creator.profile.avatar.url }}" style="border-radius: 50px;width:50px;" alt="image">
              {% else %}
                <img src="{% static 'images/user1.png' %}" style="border-radius: 50px;width:50px;" alt="image">
              {% endif %}

            </figure>
            <div class="media-body">
                <h6 class="mb-0">{{ object.creator.first_name }} {{ object.creator.last_name }}</h6>
                <p class="mb-0">{{ object.created|naturaltime }}</p>
            </div>
            <div class="dropdown d-inline-block">
              <a href="javascript:void(0);" class="icon-circle icon-30 content-color-secondary fullscreenbtn">
                  <i class="material-icons ">crop_free</i>
              </a>
                <a href="javascript:void(0)" class="icon-circle icon-30 dropdown-toggle caret-none" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="material-icons ">more_vertical</i>
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a href="" class="dropdown-item">Удалить запись</a>
                    <a href="" class="dropdown-item">Закрепить</a>
                    <a href="" class="dropdown-item">Выключить комментарии</a>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body">
      {% if object.content_hard %}
        <p class="mb-0 content-color-secondary">{{ object.content_hard|safe }}</p>
      {% endif %}
      {% if object.content_medium %}
        <p class="mb-0 content-color-secondary">{{ object.content_medium|safe }}</p>
      {% endif %}
      {% if object.content_lite %}
        <p class="mb-0 content-color-secondary">{{ object.content_lite|safe }}</p>
      {% endif %}
    </div>
    <div class="card-footer border-top py-2">

      {% include 'generic/info.html' %}

    </div>
</div>
<script>
    function like() {
        var like = $(this);
        var type = like.data('type');
        var pk = like.data('id');
        var action = like.data('action');
        var dislike = like.next();
        $.ajax({
            url: "{% url 'post_like' pk=2 %}",
            type: 'POST',
            data: {
                'obj': pk
            },
            success: function(json) {
                like.find("[data-count='like']").text(json.like_count);
                dislike.find("[data-count='dislike']").text(json.dislike_count);
                $(".like").addClass("text-success");
                $(".dislike").removeClass("text-danger");
            }
        });
        return false;
    }
    function dislike() {
        var dislike = $(this);
        var type = dislike.data('type');
        var pk = dislike.data('id');
        var action = dislike.data('action');
        var like = dislike.prev();
        $.ajax({
            url: "{% url 'post_dislike' pk %}",
            type: 'POST',
            data: {
                'obj': pk
            },
            success: function(json) {
                dislike.find("[data-count='dislike']").text(json.dislike_count);
                like.find("[data-count='like']").text(json.like_count);
                $(".dislike").addClass("text-danger");
                $(".like").removeClass("text-success");
            }
        });
        return false;
    }
    // Подключение обработчиков
    $('[data-action="like"]').click(like);
    $('[data-action="dislike"]').click(dislike);
</script>
