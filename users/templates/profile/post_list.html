{% load staticfiles humanize %}

{% if posts %}
<div class="infinite-container">
  <span class="stream">

    {% for object in posts %}
      {% include 'profile/post.html' %}

    {% endfor %}

  </span>
</div>

<div class="load">
  {% if page_obj.has_next %}
    <a class="infinite-more-link" href="?page={{ page_obj.next_page_number }}">
      <img src="{% static 'images/loading.gif' %}">
    </a>
  {% endif %}
</div>

{% else %}
<div class="card mb-4 fullscreen">
    <div class="card-header border-bottom">

    </div>
    <div class="card-body">
      <div class="media">
      <h6>  Пока ничего нет...</h6>
        <br><br>
      </div>
    </div>
</div>

{% endif %}

  <script src="{% static 'scripts/jquery.waypoints.min.js' %}" type="text/javascript"></script>
  <script src="{% static 'scripts/infinite.min.js' %}" type="text/javascript"></script>
  <script src="{% static 'scripts/posts.js' %}" type="text/javascript"></script>
  <script>
    var infinite = new Waypoint.Infinite({
      element: $('.infinite-container')[0],
      onBeforePageLoad: function () {
        $('.load').show();
      },
      onAfterPageLoad: function ($items) {
        $('.load').hide();
      }
    });
  </script>
  <script>
      function like() {
          var like = $(this);
          var type = like.data('type');
          var pk = like.data('id');
          var action  = like.data('action');
          var dislike = like.next();
          var url = "/posts/like/" + pk + "/";
          $.ajax({
              url: url,
              type: 'POST',
              data: {
                  'obj': pk
              },
              success: function(json) {
                  like.find("[data-count='like']").text(json.like_count);
                  dislike.find("[data-count='dislike']").text(json.dislike_count);
                  $(".like").addClass("text-success");
                  $(".dislike").removeClass("text-danger");
              }
          });
          return false;
      }
      function dislike() {
          var dislike = $(this);
          var type = dislike.data('type');
          var pk = dislike.data('id');
          var action = dislike.data('action');
          var like = dislike.prev();
          $.ajax({
              url: "{% url 'post_dislike' pk %}",
              type: 'POST',
              data: {
                  'obj': pk
              },
              success: function(json) {
                  dislike.find("[data-count='dislike']").text(json.dislike_count);
                  like.find("[data-count='like']").text(json.like_count);
                  $(".dislike").addClass("text-danger");
                  $(".like").removeClass("text-success");
              }
          });
          return false;
      }
      // Подключение обработчиков
      $('[data-action="like"]').click(like);
      $('[data-action="dislike"]').click(dislike);
  </script>
