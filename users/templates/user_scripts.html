{% load staticfiles %}

<script>
$('.user_page').on('click', '.avatar_detail', function() {
		var photo = $(this);
		var photo_id = photo.data("id");
		var user_uuid = photo.data("uuid");
		$('#photo_loader').html('').load("/gallery/load/avatar_detail/" + photo_id + "/" + user_uuid + "/")
		$('.photo_fullscreen').show();
});
$('#ajax').on('click', '.photo_fullscreen_hide', function() { $('.photo_fullscreen').hide(); $('#photo_loader').empty(); });
</script>

{% if request.user == user and  request.user.is_authenticated %}

<script>
function avatar_change_popap(avatar_change) {
	if ($(".wrapper").length == 0){
		$(avatar_change).wrapInner("<div class='wrapper'></div>");
	}
	$(avatar_change).show();
	$(avatar_change).click(function(e) {
		if ( e.target == this ) {
			if ($(avatar_change).is(':visible')) {
				$(avatar_change).hide();
			}
		}
	});
	$(avatar_change).find("button[name=avatar_close]").on("click", function() {
		if ($(".formElementError").is(':visible')) {
			$(".formElementError").remove();
		}
		$(avatar_change).hide();
	});
}
$(document).ready(function () {
	$("[data-js=avatar_change]").on("click", function() {
		avatar_change_popap($(".avatar_change"));
	});
});
</script>

<script>
var frm10 = $('#AVATAR-FORM');
frm10.submit(function () {
		$.ajax({
				type: frm10.attr('method'),
				url: "{% url 'user_add_avatar' pk=request.user.pk %}",
				data: new FormData($('form')[0]),
				contentType: false,
				cache: false,
				processData:false,
				success: function (data) {
					$('#avatar_reload').html('').load("{% url 'avatar_reload' pk=request.user.pk %}");
				},
				error: function(data) {
						console.log("Все не ОК")
				}
		});
		return false;
});
</script>
{% endif %}

<script>
function new_message_popap(new_message) {
	if ($(".wrapper").length == 0){
		$(new_message).wrapInner("<div class='wrapper'></div>");
	}
	$(new_message).show();
	$(new_message).click(function(e) {
		if ( e.target == this ) {
			if ($(new_message).is(':visible')) {
				$(new_message).hide();
			}
		}
	});
	$(new_message).find("button[name=message_close]").on("click", function() {
		if ($(".formElementError").is(':visible')) {
			$(".formElementError").remove();
		}
		$(new_message).hide();
	});
}
$(document).ready(function () {
	$("[data-js=new_message]").on("click", function() {
		new_message_popap($(".new_message"));
	});
});
</script>
<script>
	var lenta = new Waypoint.Infinite({
	    element: $('.lenta-container')[0], onBeforePageLoad: function() { $('.items-load').show(); }, onAfterPageLoad: function($items) { $('.items-load').hide(); }
	});
</script>
<script>
  $("#article_add").click(function() {
      $('#article_loader').html('').load("{% url 'article_add_user' pk=user.pk %}"); $('.article_fullscreen').show();
  })

  $("#form_post_btn").click(function() {
    var form_post = $('#form_post'); var stream = form_post.parent().next().next();
        $.ajax({
            type: form_post.attr('method'), url: "{% url 'post_add_user' pk=user.pk %}", data: form_post.serialize(),
            success: function(data) {
                stream.prepend(data); stream.find(".post_empty").hide(); $(".id_text").val(""); $(".add_board #for_images_upload").hide(); $(".add_board #for_gallery").hide(); $(".add_board #for_doc").hide(); $(".add_board #for_good").hide(); $(".add_board #for_question").hide(); $(".add_board #for_settings").hide();
                $.toast({ heading: '{{ request.user.first_name }}', text: 'Запись успешно создана!', showHideTransition: 'fade', icon: 'success' })},
            error: function(data) {$.toast({heading: '{{ request.user.first_name }}',text: 'Для публикации записи нужно написать что-нибудь и/или вставить изображение(ия)',showHideTransition: 'fade',icon: 'error'})}
        });
        return false;
    });
</script>
