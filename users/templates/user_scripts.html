{% load staticfiles %}
<script>

	var infinite = new Waypoint.Infinite({
	    element: $('.infinite-container')[0],
	    onBeforePageLoad: function() {
	        $('.load').show();
	    },
	    onAfterPageLoad: function($items) {
	        $('.load').hide();
	    }
	});
</script>
<script>
  var textarea = document.querySelector('.id_text');
textarea.addEventListener('keyup', function(){
  if(this.scrollTop > 0){
    this.style.height = this.scrollHeight + "px";
  }
});
</script>

<!-- ГРУЗИМ
						СТЕНУ,
						КНОПКИ ДОБАВИТЬ,
						СЧЕТЧИКИ СТАТИСТИКИ
																	ПРИ ЗАГРУЗКЕ СТРАНИЦЕ ПРОФИЛЯ-->
<script>
$(document).ready(function(){
	$('#lenta_reload').html('').load("/users/list/" + {{ user.pk }});
	$('#button_reload').html('').load("/users/profile_button/" + {{ user.pk }});
	$('#stat_reload').html('').load("/users/profile_stat/" + {{ user.pk }});
});
</script>

{% if request.user == user and  request.user.is_authenticated %}

<script>
function avatar_change_popap(avatar_change) {
	if ($(".wrapper").length == 0){
		$(avatar_change).wrapInner("<div class='wrapper'></div>");
	}
	$(avatar_change).show();
	$(avatar_change).click(function(e) {
		if ( e.target == this ) {
			if ($(avatar_change).is(':visible')) {
				$(avatar_change).hide();
			}
		}
	});
	$(avatar_change).find("button[name=avatar_close]").on("click", function() {
		if ($(".formElementError").is(':visible')) {
			$(".formElementError").remove();
		}
		$(avatar_change).hide();
	});
}
$(document).ready(function () {
	$("[data-js=avatar_change]").on("click", function() {
		avatar_change_popap($(".avatar_change"));
	});
});
</script>

<script>
var frm10 = $('#AVATAR-FORM');
frm10.submit(function () {
		$.ajax({
				type: frm10.attr('method'),
				url: "{% url 'user_avatar_form' pk=request.user.pk %}",
				data: new FormData($('form')[0]),
				contentType: false,
				cache: false,
				processData:false,
				success: function (data) {
					console.log("Все ОК")
				},
				error: function(data) {
						console.log("Все не ОК")
				}
		});
		return false;
});
</script>
{% endif %}

<script>
function new_message_popap(new_message) {
	if ($(".wrapper").length == 0){
		$(new_message).wrapInner("<div class='wrapper'></div>");
	}
	$(new_message).show();
	$(new_message).click(function(e) {
		if ( e.target == this ) {
			if ($(new_message).is(':visible')) {
				$(new_message).hide();
			}
		}
	});
	$(new_message).find("button[name=message_close]").on("click", function() {
		if ($(".formElementError").is(':visible')) {
			$(".formElementError").remove();
		}
		$(new_message).hide();
	});
}
$(document).ready(function () {
	$("[data-js=new_message]").on("click", function() {
		new_message_popap($(".new_message"));
	});
});
</script>
