{% load staticfiles %}
<script src="/static/scripts/cockie.js" type="text/javascript"></script>

<script>
function remove() {
var remove = $(this);
var pk = remove.data('id');
$.ajax({
	url: "/users/delete/" + pk + "/",
	success: function (data) {
		$(remove).parents('.card').hide();
		$.toast({
				heading: '{{ request.user.first_name }}',
				text: 'Вы успешно удалили элемент!',
				showHideTransition: 'fade',
				icon: 'error'
		})
	},
	error: function(data) {
	}
});
};
$('[data-action="item_remove"]').click(remove);
</script>

<script>
function fixed() {
var fixed = $(this);
var pk = fixed.data('id');
$.ajax({
	url: "/users/fixed/" + pk + "/",
	success: function (data) {
		fixed.parent().html("<span data-action='item_unfixed' data-id='{{ object.pk }}' style='cursor:pointer' class='dropdown-item'>Открепить</span>");
		fixed.parent().parent().parent().parent().parent().find(".is_fixed").show();
		$.toast({
				heading: '{{ request.user.first_name }}',
				text: 'Вы успешно закрепили элемент!',
				showHideTransition: 'fade',
				icon: 'info'
		})
	},
	error: function(data) {
	}
});
};

function unfixed() {
var unfixed = $(this);
var pk = unfixed.data('id');
$.ajax({
	url: "/users/unfixed/" + pk + "/",
	success: function (data) {
		unfixed.parent().html("<span data-action='item_fixed' data-id='{{ object.pk }}' style='cursor:pointer' class='dropdown-item'>Закрепить</span>");
		unfixed.parent().parent().parent().parent().parent().find(".is_fixed").hide();
		$.toast({
				heading: '{{ request.user.first_name }}',
				text: 'Вы успешно открепили элемент!',
				showHideTransition: 'fade',
				icon: 'info'
		})
	},
	error: function(data) {
	}
});
};
$('[data-action="item_fixed"]').click(fixed);
$('[data-action="item_unfixed"]').click(unfixed);
</script>

<script>
$('.fullscreen').on('click', function () {
	 var item = $(this);
	 var item_id = item.data("id");
	 $('#item_loader').html('').load("/users/item/" + item_id)
	 $('.activefullscreen').show();
});
</script>

<script>
$('.article_detail').on('click', function (e) {
	e.preventDefault();
	 var item = $(this);
	 var item_id = item.data("id");
	 $('#article_loader').html('').load("/article/detail/" + item_id)
	 $('.activefullscreen2').show();
});
</script>

<script>
	$( "#article_add" ).click(function(){
		$('#article_loader').html('').load("/article/add/");
		$('.activefullscreen2').show();
	})
</script>

<script>
	function art_like() {
			var like = $(this);
			var article = $('.infinite-item').attr("article-id");
			var type = like.data('type');
			var pk = like.data('id');
			var action  = like.data('action');
			var dislike = like.next().next();
			payload = {
					'article': article,
					'csrf_token': csrftoken
				}
			$.ajax({
					url: "/article/like/" + pk + "/",
					type: 'POST',
					cache: false,
					data: payload,
					success: function(data) {
							like.find("[data-count='like']").text(data.like_count);
							dislike.find("[data-count='dislike']").text(data.dislike_count);
							$(like).addClass("text-success");
							$(dislike).removeClass("text-danger");
							$(like).siblings('.like_window').html('').load("/article/like_window/" + pk + "/");
							$(dislike).siblings('.dislike_window').html('').load("/article/dislike_window/" + pk + "/")
					}
			});
			return false;
	}
	function art_dislike() {
			var dislike = $(this);
			var article = $('.infinite-item').attr("article-id");
			var type = dislike.data('type');
			var pk = dislike.data('id');
			var action = dislike.data('action');
			var like = dislike.prev().prev();
			payload = {
					'article': article,
					'csrf_token': csrftoken
				}
			$.ajax({
					url: "/article/dislike/" + pk + "/",
					type: 'POST',
					cache: false,
					data: payload,
					success: function(data) {
							dislike.find("[data-count='dislike']").text(data.dislike_count);
							like.find("[data-count='like']").text(data.like_count);
							$(dislike).addClass("text-danger");
							$(like).removeClass("text-success");
							$(like).siblings('.like_window').html('').load("/article/like_window/" + pk + "/");
							$(dislike).siblings('.dislike_window').html('').load("/article/dislike_window/" + pk + "/")
					}
			});
			return false;
	}
	// Подключение обработчиков
	$('[data-action="art_like"]').click(art_like);
	$('[data-action="art_dislike"]').click(art_dislike);
</script>

<script>
	function post_like() {
			var like = $(this);
			var post = $('.infinite-item').attr("post-id");
			var type = like.data('type');
			var pk = like.data('id');
			var action  = like.data('action');
			var dislike = like.next().next();
			payload = {
					'post': post,
					'csrf_token': csrftoken
				}
			$.ajax({
					url: "/posts/like/" + pk + "/",
					type: 'POST',
					cache: false,
					data: payload,
					success: function(data) {
							like.find("[data-count='like']").text(data.like_count);
							dislike.find("[data-count='dislike']").text(data.dislike_count);
							$(like).addClass("text-success");
							$(dislike).removeClass("text-danger");
							$(like).siblings('.like_window').html('').load("/posts/like_window/" + pk + "/");
							$(dislike).siblings('.dislike_window').html('').load("/posts/dislike_window/" + pk + "/")
					}
			});
			return false;
	}
	function post_dislike() {
			var dislike = $(this);
			var post = $('.infinite-item').attr("posts-id");
			var type = dislike.data('type');
			var pk = dislike.data('id');
			var action = dislike.data('action');
			var like = dislike.prev().prev();
			payload = {
					'post': post,
					'csrf_token': csrftoken
				}
			$.ajax({
					url: "/posts/dislike/" + pk + "/",
					type: 'POST',
					cache: false,
					data: payload,
					success: function(data) {
							dislike.find("[data-count='dislike']").text(data.dislike_count);
							like.find("[data-count='like']").text(data.like_count);
							$(dislike).addClass("text-danger");
							$(like).removeClass("text-success");
							$(like).siblings('.like_window').html('').load("/posts/like_window/" + pk + "/");
							$(dislike).siblings('.dislike_window').html('').load("/posts/dislike_window/" + pk + "/")
					}
			});
			return false;
	}
	// Подключение обработчиков
	$('[data-action="post_like"]').click(post_like);
	$('[data-action="post_dislike"]').click(post_dislike);
</script>


<script>
$(".art_comment").on("click", function () {
	var article = $(this).closest(".infinite-item").attr("article-id");
	var url = $(this).parents(".infinite-item");
	$.ajax({
			url: '{% url "article_get_comment" %}',
			data: {'article': article},
			cache: false,
			beforeSend: function () {
					url.find(".load_comments").html("<span style='display:flex;justify-content: center;'><img src='/static/images/loading.gif'></span>");
			},
			success: function (data) {
				url.find(".load_comments").html(data.comments);
			}
	});
	return false;
});
</script>
<script>
$(".post_comment").on("click", function () {
	var post = $(this).closest(".infinite-item").attr("post-id");
	var url = $(this).parents(".infinite-item");
	$.ajax({
			url: '{% url "post_get_comment" %}',
			data: {'post': post},
			cache: false,
			beforeSend: function () {
					url.find(".load_comments").html("<span style='display:flex;justify-content: center;'><img src='/static/images/loading.gif'></span>");
			},
			success: function (data) {
				url.find(".load_comments").html(data.comments);
			}
	});
	return false;
});
</script>

<script>
function new_message_popap(new_message) {
	if ($(".wrapper").length == 0){
		$(new_message).wrapInner("<div class='wrapper'></div>");
	}
	$(new_message).show();
	$(new_message).click(function(e) {
		if ( e.target == this ) {
			if ($(new_message).is(':visible')) {
				$(new_message).hide();
			}
		}
	});
	$(new_message).find("button[name=message_close]").on("click", function() {
		if ($(".formElementError").is(':visible')) {
			$(".formElementError").remove();
		}
		$(new_message).hide();
	});
}
$(document).ready(function () {
	$("[data-js=new_message]").on("click", function() {
		new_message_popap($(".new_message"));
	});
});
</script>

<script>
function avatar_change_popap(avatar_change) {
	if ($(".wrapper").length == 0){
		$(avatar_change).wrapInner("<div class='wrapper'></div>");
	}
	$(avatar_change).show();
	$(avatar_change).click(function(e) {
		if ( e.target == this ) {
			if ($(avatar_change).is(':visible')) {
				$(avatar_change).hide();
			}
		}
	});
	$(avatar_change).find("button[name=avatar_close]").on("click", function() {
		if ($(".formElementError").is(':visible')) {
			$(".formElementError").remove();
		}
		$(avatar_change).hide();
	});
}
$(document).ready(function () {
	$("[data-js=avatar_change]").on("click", function() {
		avatar_change_popap($(".avatar_change"));
	});
});
</script>


<script type="text/javascript">
    var frm = $('#FORM-POST');
    frm.submit(function () {
        $.ajax({
            type: frm.attr('method'),
            url: "{% url 'post_add_user' %}",
            data: frm.serialize(),
            success: function (data) {
              $(".stream").prepend(data);
              $(".id_text").val("");
              $.toast({
                  heading: '{{ request.user.first_name }}',
                  text: 'Запись успешно создана!',
                  showHideTransition: 'fade',
                  icon: 'success'
              })
            },
            error: function(data) {
                $("#hack").html("Возникла непредвидинная ошибка!!");
            }
        });
        return false;
    });
</script>

<script>
function remove() {
var remove = $(this);
var pk = remove.data('id');
$.ajax({
	url: "/article/delete/" + pk + "/",
	success: function (data) {
		$(remove).parents('.card').hide();
		$.toast({
				heading: '{{ request.user.first_name }}',
				text: 'статья успешно удалена!',
				showHideTransition: 'fade',
				icon: 'error'
		})
	},
	error: function(data) {
	}
});
};
$('[data-action="article_remove"]').click(remove);
</script>
<script>
var frm10 = $('#AVATAR-FORM');
frm10.submit(function () {
		$.ajax({
				type: frm10.attr('method'),
				url: "{% url 'user_avatar_form' pk=request.user.pk %}",
				data: new FormData($('form')[0]),
				contentType: false,
				cache: false,
				processData:false,
				success: function (data) {
					console.log("Все ОК")
				},
				error: function(data) {
						console.log("Все не ОК")
				}
		});
		return false;
});
</script>
